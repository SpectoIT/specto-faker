"use strict";var specto_faker={initiated:!1,config:{object_selector:".faker",open_class:"open",init_class:"faker-init",anim_class:"faker-animated",anim_progress_class:"faker-animating",focused_class:"faker-focused",key_events_class:"faker-keyevent",searchable_class:"faker-search",select_single:"faker-sel-single",braille_class:"faker-braille",selected_val_class:"active",disabled_val_class:"rel-disabled",search_hidden:"rel-search",nv_helper_class:"non-visual-helper",animated:!1,animation_speed:400,count_selected:!1,count_disables:!0,key_events:!1,searchable:!0,search_single:!0,sortable:!1,sort_ascending:!0,before_change:function(e,a){return e},on_change:null,on_init:null,braille_support:!1},lastClosedFaker:null,init:function(e){var a=$.extend({},specto_faker.config,e&&"object"==typeof e?e:{}),s=[];return specto_faker.initiated||(specto_faker.config.init_class=a.init_class,specto_faker.config.open_class=a.open_class,specto_faker.config.anim_class=a.anim_class,specto_faker.config.anim_progress_class=a.anim_progress_class,specto_faker.config.focused_class=a.focused_class,specto_faker.config.selected_val_class=a.selected_val_class,specto_faker.config.disabled_val_class=a.disabled_val_class,specto_faker.config.key_events_class=a.key_events_class,specto_faker.config.searchable_class=a.searchable_class,specto_faker.config.select_single=a.select_single,specto_faker.config.braille_class=a.braille_class,specto_faker.config.search_hidden=a.search_hidden,specto_faker.config.nv_helper_class=a.nv_helper_class,specto_faker.config.count_selected=a.count_selected,specto_faker.config.count_disables=a.count_disables),$(a.object_selector).each(function(){var e=specto_faker.getTargetelement(this),t=!1;if(s.push(e),a.sortable&&specto_faker.sortValues(e,a.sort_ascending),$(e).find(".drop-value, .drop-handle").each(function(){$(this).off("click").click(function(){var e=$(this).parent();specto_faker.isFakerOpen(e)?specto_faker.animateFaker(e):specto_faker.animateFaker(e,"openme")})}),specto_faker.fakerSelection(e,a.on_change,a.before_change),$(e).find(".drop-value span").text()||($(e).find(".drop-selection > div[selected]").length?specto_faker.updateValue($(e).find(".drop-selection > div[selected]").first().addClass(specto_faker.config.selected_val_class),"noclick"):specto_faker.updateValue($(e).find(".drop-selection > div").first(),"noclick")),$(e).find("select").each(function(){t=!0,$(this).removeClass("faker").off("focus").focus(function(){specto_faker.isFakerOpen(e)||($("."+specto_faker.config.init_class+"."+specto_faker.config.open_class).each(function(){specto_faker.animateFaker(this)}),specto_faker.animateFaker($(this).parent().addClass(specto_faker.config.focused_class),"openme"))}),a.searchable&&a.key_events||$(this).off("blur").blur(function(){specto_faker.animateFaker($(this).parent().removeClass(specto_faker.config.focused_class))})}),!t&&a.braille_support?specto_faker.hasFakerNvHelperInput(e)||($(e).prepend("<input class='"+specto_faker.config.nv_helper_class+"' name='non-visual-helper' />"),$(e).find("."+specto_faker.config.nv_helper_class).each(function(){$(this).focus(function(a){specto_faker.isFakerOpen($(this).parent())||($("."+specto_faker.config.init_class+"."+specto_faker.config.open_class).each(function(){specto_faker.animateFaker(this)}),specto_faker.animateFaker($(this).parent().addClass(specto_faker.config.focused_class),"openme"),$(this).attr("title","combo box "+specto_faker.getFakerUserValue(e)+" expanded")),specto_faker.brailleSpeach(e,"selection")}).blur(function(){$(this).parent().removeClass(specto_faker.config.focused_class)})}),specto_faker.isFakerSearchable(e)||$(e).click(function(){$(this).find("."+specto_faker.config.nv_helper_class).each(function(){$(this).focus()})})):$(e).find("."+specto_faker.config.nv_helper_class).each(function(){$(this).remove()}),a.animated?$(e).addClass(specto_faker.config.anim_class):$(e).removeClass(specto_faker.config.anim_class),a.braille_support?($(e).addClass(specto_faker.config.braille_class),a.key_events=!0):$(e).removeClass(specto_faker.config.braille_class),a.key_events?$(e).addClass(specto_faker.config.key_events_class):$(e).removeClass(specto_faker.config.key_events_class),a.searchable&&a.key_events?($(e).addClass(specto_faker.config.searchable_class),a.search_single&&$(e).addClass(specto_faker.config.select_single)):$(e).removeClass(specto_faker.config.searchable_class),$(e).addClass(specto_faker.config.init_class),t&&$(e).parents("form").length>0)switch(document.readyState){case"complete":$(e).parentsUntil("form").last().parent()[0].reset();break;default:$(window).load(function(){$(e).parentsUntil("form").last().parent()[0].reset()})}}),specto_faker.initiated||($(document).mouseup(function(e){$("."+specto_faker.config.init_class+"."+specto_faker.config.open_class).each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||specto_faker.animateFaker(this)})}),$(document).on("keyup",function(e){var a=!1;($("."+specto_faker.config.init_class+"."+specto_faker.config.key_events_class+"."+specto_faker.config.open_class).each(function(){specto_faker.keyEvents(this,e),a=!0}),a)||13===(e.keyCode||e.which)&&specto_faker.lastClosedFaker&&specto_faker.animateFaker(specto_faker.lastClosedFaker,"openme")})),specto_faker.config.animation_speed=a.animation_speed,specto_faker.initiated=!0,a.on_init&&a.on_init(s),s},fakerSelection:function(e,a,s){$(e).find(".drop-selection div").each(function(){$(this).off().click(function(t){if("string"!=typeof $(this).attr("disabled")){if(s&&!s(specto_faker.getSelectionValue(this),t))return t.preventDefault(),void t.stopPropagation();$(this).siblings().filter(function(){return $(this).hasClass(specto_faker.config.selected_val_class)}).each(function(){$(this).removeClass(specto_faker.config.selected_val_class)}),specto_faker.updateValue(this);var c=this;setTimeout(function(){$(c).addClass(specto_faker.config.selected_val_class)},specto_faker.isFakerAnimated(e)?specto_faker.config.animation_speed:0),a&&a(specto_faker.getSelectionValue(this),t)}})})},updateValue:function(e,a,s){if(!($(e).length<1)){$(e).siblings().filter(function(){return $(this).hasClass(specto_faker.config.selected_val_class)}).each(function(){$(this).removeClass(specto_faker.config.selected_val_class)}),$(e).addClass(specto_faker.config.selected_val_class);var t=$(e).parent().prevAll(".drop-value").attr("rel",$(e).attr("rel")).find("span").text($(e).text()).parent(),c=$(e).parent().prevAll("select");c.length>0&&$(c).val(specto_faker.getSelectionValue(e)).change(),a||$(t).trigger("click");var n=$(e).parent().parent();specto_faker.isFakerBrailleSupport(n)&&(specto_faker.isFakerSearchable(n)&&specto_faker.hasFakerNvHelperInput(n)&&$(n).find("."+specto_faker.config.nv_helper_class).each(function(){s&&$(this).removeAttr("title").focus()}),specto_faker.brailleSpeach($(e).parent().parent(),"selection"))}},getFakerValue:function(e){return $(e).find(".drop-value").attr("rel")},getFakerUserValue:function(e){return $(e).find(".drop-value span").text()},setFakerValue:function(e,a,s){specto_faker.updateValue($(e).find(".drop-selection div[rel='"+a+"']"),s)},getSelectionValue:function(e){return $(e).attr("rel")},isFakerOpen:function(e){return $(e).hasClass(specto_faker.config.open_class)},isFakerAnimated:function(e){return $(e).hasClass(specto_faker.config.anim_class)},isFakerSearchable:function(e){return $(e).hasClass(specto_faker.config.searchable_class)},isFakerBrailleSupport:function(e){return $(e).hasClass(specto_faker.config.braille_class)},hasFakerNvHelperInput:function(e){return $(e).find("."+specto_faker.config.nv_helper_class).length>0},animateFaker:function(e,a){if(specto_faker.isFakerAnimated(e)){if($(e).hasClass(specto_faker.config.anim_progress_class))return;if($(e).addClass(specto_faker.config.anim_progress_class),a){specto_faker.makeFakerSearchable(e);var s=$(e).find(".drop-selection").css({visibility:"hidden",opacity:"1"}),t="div";specto_faker.config.count_selected&&(t+=":not(."+specto_faker.config.selected_val_class+")"),specto_faker.config.count_disables&&(t+=":not(."+specto_faker.config.disabled_val_class+")"),$(s).css({height:"0px",visibility:"visible"}).animate({height:$(s).find("div").first().height()*$(s).find(t).length+"px"},{duration:specto_faker.config.animation_speed,always:function(){$(s).removeAttr("style"),$(e).addClass(specto_faker.config.open_class),$(e).removeClass(specto_faker.config.anim_progress_class)}}),specto_faker.isFakerSearchable(e)&&specto_faker.hasFakerNvHelperInput(e)&&$(e).find("."+specto_faker.config.nv_helper_class).each(function(){$(this).attr("tabindex","-1")})}else{specto_faker.removeFakerSearchable(e);s=$(e).find(".drop-selection");$(s).css({height:$(s).height()+"px"}).animate({height:"0px"},{duration:specto_faker.config.animation_speed,always:function(){$(s).removeAttr("style"),$(e).removeClass(specto_faker.config.open_class).removeClass(specto_faker.config.anim_progress_class),specto_faker.lastClosedFaker=e}}),specto_faker.isFakerBrailleSupport(e)&&specto_faker.brailleSpeach(e,"close"),specto_faker.isFakerSearchable(e)&&specto_faker.hasFakerNvHelperInput(e)&&setTimeout(function(){$(e).find("."+specto_faker.config.nv_helper_class).each(function(){$(this).removeAttr("tabindex")})},20)}}else a?($(e).addClass(specto_faker.config.open_class),specto_faker.makeFakerSearchable(e,"focus_me"),specto_faker.isFakerSearchable(e)&&specto_faker.hasFakerNvHelperInput(e)&&$(e).find("."+specto_faker.config.nv_helper_class).each(function(){$(this).attr("tabindex","-1")})):($(e).removeClass(specto_faker.config.open_class),specto_faker.removeFakerSearchable(e),specto_faker.lastClosedFaker=e,specto_faker.isFakerBrailleSupport(e)&&specto_faker.brailleSpeach(e,"close"),specto_faker.isFakerSearchable(e)&&specto_faker.hasFakerNvHelperInput(e)&&setTimeout(function(){$(e).find("."+specto_faker.config.nv_helper_class).each(function(){$(this).removeAttr("tabindex")})},20))},getTargetelement:function(e){if("SELECT"===$(e).prop("tagName")){if($(e).parent().hasClass(specto_faker.config.init_class))return $(e).parent();var a=$(e).attr("placeholder"),s=$("<div class='faker'><div class='drop-value'><span></span></div><div class='drop-handle'>&nbsp;</div><div class='drop-selection'></div></div>");$(e).find("option").each(function(){var e=$(this).text(),t="string"==typeof $(this).attr("selected");t&&(a=""),$(s).find(".drop-selection").append("<div rel='"+($(this).attr("value")||e)+"'"+("string"==typeof $(this).attr("disabled")?" disabled='disabled' class='"+specto_faker.config.disabled_val_class+"'":"")+(t?" selected='selected'":"")+">"+e+"</div>")}),$(s).prepend($(e).clone(!0)),a&&($(s).find(".drop-value span").text(a),$(s).find(".drop-selection").prepend("<div rel='' disabled='disabled' class='"+specto_faker.config.disabled_val_class+"'>"+a+"</div>"),$(s).find("option[value='']").length<1&&$(s).find("select").prepend("<option value='' selected='selected' disabled='disabled'>placeholder</option>")),$(e).after(s);var t=$(e).next();return $(e).remove(),t}return e},updateOptions:function(e,a,s,t,c){$(e).each(function(){$(this).find(".drop-value span").each(function(){$(this).text("")}),$(this).find(".drop-selection").each(function(){$(this).empty();var e="";$.each(a,function(a,c){e+="<div rel='"+c[s||"rel"]+"' "+(c.is_default?"selected":"")+">"+c[t||"name"]+"</div>"}),$(this).append(e)}),$(e).find("select").each(function(){$(this).empty();var e="";$.each(a,function(a,c){e+="<option value='"+c[s||"rel"]+"'>"+c[t||"name"]+"</option>"}),$(this).append(e)}),$(this).specto_faker(c)})},keyEvents:function(e,a){if(specto_faker.isFakerOpen(e)){var s=a.keyCode||a.which;switch(s){case 13:specto_faker.animateFaker(e);break;case 40:specto_faker.selection.next(e);break;case 38:specto_faker.selection.previous(e);break;default:if(specto_faker.isFakerSearchable(e))specto_faker.filterBySearchInput(e);else{var t=String.fromCharCode(s);t.search(/[a-zA-Z0-9\.\-]/)>-1&&specto_faker.selection.tochar(e,t.toLowerCase())}}}},selection:{filter_fn:function(){return!$(this).hasClass(specto_faker.config.disabled_val_class)&&!$(this).hasClass(specto_faker.config.search_hidden)},next:function(e){var a=!1;$(e).find(".drop-selection div."+specto_faker.config.selected_val_class).first().each(function(){if(a=!0,$(this).nextAll().filter(specto_faker.selection.filter_fn).length>0)specto_faker.updateValue($(this).nextAll().filter(specto_faker.selection.filter_fn).first(),"noclick","keyevent");else{var e=$(this).prevAll().filter(specto_faker.selection.filter_fn);e.length>0&&specto_faker.updateValue(e.last(),"noclick","keyevent")}}),a||specto_faker.updateValue($(e).find(".drop-selection div").filter(specto_faker.selection.filter_fn).first(),"noclick","keyevent")},previous:function(e){var a=!1;$(e).find(".drop-selection div."+specto_faker.config.selected_val_class).first().each(function(){if(a=!0,$(this).prevAll().filter(specto_faker.selection.filter_fn).length>0)specto_faker.updateValue($(this).prevAll().filter(specto_faker.selection.filter_fn).first(),"noclick","keyevent");else{var e=$(this).nextAll().filter(specto_faker.selection.filter_fn);e.length>0&&specto_faker.updateValue(e.last(),"noclick","keyevent")}}),a||specto_faker.updateValue($(e).find(".drop-selection div").filter(specto_faker.selection.filter_fn).last(),"noclick","keyevent")},tochar:function(e,a){var s=!1;$(e).find(".drop-selection div."+specto_faker.config.selected_val_class).first().each(function(){$(this).text().slice(0,1).toLowerCase()==a&&(s=!0)}),s?$(e).find(".drop-selection div."+specto_faker.config.selected_val_class).first().each(function(){var e=$(this).nextAll().filter(function(){return $(this).text().slice(0,1).toLowerCase()==a&&!$(this).hasClass(specto_faker.config.search_hidden)});e.length<1?s=!1:specto_faker.updateValue(e.first(),"noclick","keyevent")}):$(e).find(".drop-selection div").filter(function(){return $(this).text().slice(0,1).toLowerCase()==a&&!$(this).hasClass(specto_faker.config.search_hidden)}).first().each(function(){specto_faker.updateValue(this,"noclick","keyevent")})}},makeFakerSearchable:function(e,a){if(specto_faker.isFakerSearchable(e)){var s=specto_faker.isFakerBrailleSupport(e)?"combo box "+specto_faker.getFakerUserValue(e)+" expanded. This combo box can be searchable by input, use arrow keys to browse suggestions which are changed accordingly":"";$(e).find(".drop-value").append("<input autocomplete='nope' type='text' name='faker-search' class='form-control' tabindex='-1' title='"+s+"' />"),$(e).find("input[name='faker-search']").each(function(){$(this).click(function(e){e.preventDefault(),e.stopPropagation()}),$(this).on("keydown",function(e){switch(e.keyCode||e.which){case 9:specto_faker.animateFaker($(this).parent().parent().removeClass(specto_faker.config.focused_class))}}),$(this).focus()})}},removeFakerSearchable:function(e){specto_faker.isFakerSearchable(e)&&($(e).find("input[name='faker-search']").each(function(){$(this).remove()}),$(e).find(".drop-selection div."+specto_faker.config.search_hidden).each(function(){$(this).removeClass(specto_faker.config.search_hidden)})),specto_faker.isFakerBrailleSupport(e)&&specto_faker.brailleSpeach(e,"close")},filterBySearchInput:function(e){var a=$(e).find("input[name='faker-search']").val();a&&(a=a.toLowerCase());var s=0;$(e).find(".drop-selection div").each(function(){$(this).text().toLowerCase().search(a)>-1?($(this).removeClass(specto_faker.config.search_hidden),s++):$(this).addClass(specto_faker.config.search_hidden)}),1===s&&$(e).hasClass(specto_faker.config.select_single)&&($(e).find("."+specto_faker.config.nv_helper_class).each(function(){$(this).focus()}),$(e).find(".drop-selection div:not(."+specto_faker.config.search_hidden+")").each(function(){specto_faker.updateValue(this)}))},sortValues:function(e,a){var s=[];return $(e).find(".drop-selection div:not(."+specto_faker.config.disabled_val_class+")").each(function(e){s.push({rel:$(this).attr("rel"),val:$(this).text(),i:e})}),s.sort(function(e,s){return e.val.localeCompare(s.val)*(a?1:-1)}),$.each(s,function(a,s){$(e).find(".drop-selection").append($(e).find(".drop-selection div:not(."+specto_faker.config.disabled_val_class+")").eq(s.i).clone().addClass("tmp"))}),$.each(s,function(a,s){$(e).find(".drop-selection div:not(."+specto_faker.config.disabled_val_class+"):not(.tmp)").each(function(){$(this).remove()})}),$(e).find(".drop-selection div.tmp").each(function(){$(this).removeClass("tmp")}),!0},brailleSpeach:function(e,a,s){switch(a){case"selection":var t=specto_faker.getFakerUserValue(e)+" "+($(e).find(".drop-selection div."+specto_faker.config.selected_val_class).prevAll().filter(specto_faker.selection.filter_fn).length+1)+" of "+$(e).find(".drop-selection div").filter(specto_faker.selection.filter_fn).length;specto_faker.hasFakerNvHelperInput(e)?$(e).find("."+specto_faker.config.nv_helper_class).val(t):$(document.activeElement).attr("title",t);break;case"close":$(document.activeElement).attr("title","combo box "+specto_faker.getFakerUserValue(e)+" collapsed")}}};!function(e){e.fn.specto_faker=function(a){return specto_faker.init(e.extend(a,{object_selector:this}))}}(jQuery);